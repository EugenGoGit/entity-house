/*
  Сервис управления группами животных
*/
syntax = "proto3";

import "google/api/annotations.proto";
import "google/api/field_behavior.proto";
import "google/protobuf/timestamp.proto";
import "impl.api.proto";
import "entity.feature.proto";

import "protoc-gen-openapiv2/options/annotations.proto";

package pet.v1;

option java_package = "ru.{PackageName}";
option java_outer_classname = "{PackageNameCamelCase}Proto";
option java_multiple_files = false;
option java_string_check_utf8 = true;
option go_package = "/{PackageNameSnakeCase}";
option cc_enable_arenas = true;
option csharp_namespace = "{PackageNameDotCamelCase}";
option objc_class_prefix = "{PackageNameUpperCase}";
option php_namespace = "{PackageNameDoubleSlashCamelCase}";
option ruby_package = "{PackageNameDoubleColonCamelCase}";
option optimize_for = LITE_RUNTIME;

// Группа животных
message PetGroup {
  option (impl.api.specification) = {
    serverside_entity_crud: {
      http_root: "pet/api/v1/pet_group"
      custom_comments: {
        leading_comment: "Сервис управления группами животных"
        additional_leading_comment: "Сервис реализуется в проекте Dummy"
      }
      method_set: {
        get: {
          custom_comments:{
            leading_comment: "Метод получения группы животных"
            additional_leading_comment: "Для owner, employee возвращаются только группы животных c COMPANY_ID из токена.\nМетод доступен для: admin, service, bti, seller, owner, employee"
            request_leading_comment: "Запрос получения группы животных"
            response_leading_comment: "Ответ на запрос получения группы животных"
          }
        }
        get_list: {
          custom_comments:{
            leading_comment: "Метод получения списка групп животных"
            additional_leading_comment: "Метод доступен для: admin, service, bti, seller, owner, employee"
            request_leading_comment: "Запрос получения списка групп животных"
            response_leading_comment: "Ответ на запрос получения списка групп животных"
          }
          order_by_values: {name:"ID", title: "По идентификатору"}
          order_by_values: {name:"CREATED_AT", title: "По времени создания"}
          order_by_values: {name:"STREET_THEN_NUMBER_THEN_PART", title: "По улице, номеру дома, корпусу"}
        }
        get_count: {
          custom_comments:{
            leading_comment: "Метод получения количества групп животных"
            additional_leading_comment: "Метод доступен для: admin, service, bti, seller, owner, employee"
            request_leading_comment: "Запрос получения количества групп животных"
            response_leading_comment: "Ответ на запрос получения количества групп животных"
          }
        }
        save_create_replace:{
          custom_comments:{
            leading_comment: "Метод создания и изменения группы животных"
            additional_leading_comment: "Метод доступен для: admin, service, bti, seller, owner, employee"
            request_leading_comment: "Запрос на создание/редактирование группы животных"
            response_leading_comment: "Ответ на запрос создания/редактирования группы животных"
          }
        }
        delete: {
          custom_comments: {
            leading_comment: "Метод удаления группы животных"
            additional_leading_comment: "Метод доступен для: admin, service, bti, seller, owner, employee"
            request_leading_comment: "Запрос удаления группы животных"
            response_leading_comment: "Ответ на запрос удаления группы животных"
          }
        }
        attach: {
          custom_comments: {
            leading_comment: "Метод привязки группы животных и комнаты"
            additional_leading_comment: "Метод доступен для: admin, service, bti, owner, employee"
            request_leading_comment: "Запрос на привязку группы животных и комнаты"
            response_leading_comment: "Ответ на запрос на привязку группы животных и комнаты"
          }
          linked_type_name: "Room"
          link_key_field_path: "id/{data.id}/room_id/{data.room_id}"
        }
        detach: {
          custom_comments: {
            leading_comment: "Метод отвязки группы животных и комнаты"
            additional_leading_comment: "Метод доступен для: admin, service, bti, owner, employee"
            request_leading_comment: "Запрос на отвязку группы животных и комнаты"
            response_leading_comment: "Ответ на запрос на отвязку группы животных и комнаты"
          }
          linked_type_name: "Room"
          link_key_field_path: "id/{data.id}/room_id/{data.room_id}"
        }
      }
    }
  };
  // Идентификатор группы животных.
  // # Тип: Guid
  string id = 1 [(entity.feature.unique_field_group) = PK];
  // Наименование.
  // # Диапазон: 3..256
  string title = 2 [(google.api.field_behavior) = REQUIRED, (grpc.gateway.protoc_gen_openapiv2.options.openapiv2_field) = {
    example: "UTCPLUS0300MOSCOW_STPETERSBURG_VOLGOGRAD"
  }
  ];
  // Описание.
  // # Диапазон: 3..256
  string description = 3;
  // Дата удаления группы животных из использования
  google.protobuf.Timestamp deleted_at = 4;
  // Дата изменения группы животных.
  // Поле используется при редактировании и создании для контроля актуальности изменяемой версии
  google.protobuf.Timestamp changed_at = 5 [(google.api.field_behavior) = REQUIRED];
  // Теги группы.
  // # Диапазон: 0..10
  repeated string tags = 6;
  // Ошибка сохранения
  message SavingError {
    // Конфликт версий.
    // Причины:
    // - В базе хранится другая версия строки, значения changed_at отличаются
    message Conflict {}
    // Причина ошибки
    oneof reason {
      // Конфликт версий
      Conflict conflict = 1;
    }
  }
}

// Фильтр групп животных
message PetGroupFilter {
  // По тексту.
  // Если значение не передано то поиск по нему не производится.
  // # Диапазон: 3..64.
  // # Поиск производится по полям:
  // # - Наименование
  string text = 1;
  // По тегам.
  // # Диапазон: 0..10
  repeated string tags = 2;
}

// Связка группы животных и комнаты
message PetGroupRoom {
  // Идентификатор группы животных.
  // # Тип: Guid
  string id = 1 [(google.api.field_behavior) = REQUIRED];
  // Идентификатор комнаты.
  // Тип: Guid
  string room_id = 2 [(google.api.field_behavior) = REQUIRED];
}
